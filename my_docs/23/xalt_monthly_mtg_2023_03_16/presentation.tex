\documentclass{beamer}

% You can also use a 16:9 aspect ratio:
%\documentclass[aspectratio=169]{beamer}
\usetheme{TACC16}
\usepackage{graphicx}

% It's possible to move the footer to the right:
%\usetheme[rightfooter]{TACC16}


% Detailed knowledge of application workload characteristics can
% optimize performance of current and future systems. This may sound
% daunting, with many HPC data centers hosting over 2,000 users running
% thousands of applications and millions of jobs per month.  XALT is an
% open source tool developed at the Texas Advanced Computing Center
% (TACC) that collects system usage information to quantitatively report
% how users are using your system. This session will explore the
% benefits of detailed application workload profiling and how the XALT
% tool has helped leading supercomputing sites unlock the power of their
% application usage data.

%% page 
%\begin{frame}{}
%  \begin{itemize}
%    \item
%  \end{itemize}
%\end{frame}
%
%% page 
%\begin{frame}[fragile]
%    \frametitle{}
% {\tiny
%    \begin{semiverbatim}
%    \end{semiverbatim}
%}
%  \begin{itemize}
%    \item
%  \end{itemize}
%
%\end{frame}



\begin{document}
\title[XALT]{New Path w/ Commandline Arguments Filtering}
\author{Robert McLay}
\date{March 16, 2023}

% page 1
\frame{\titlepage}

% page 2
\begin{frame}{XALT: Outline}
  \center{\includegraphics[width=.9\textwidth]{XALT_Sticker.png}}
  \begin{itemize}
    \item Based on last month's presentation
    \item I have implemented ``Approach 2''
    \item Namely a built-in pattern matching
    \item It is not perfect
    \item But it will work well with python
    \item It is currently available under the testing branch
  \end{itemize}
\end{frame}

% page 3
\begin{frame}[fragile]
    \frametitle{Some issue to deal with}
  \begin{itemize}
    \item Many commands take command line argument
    \item This includes python
    \item Below is a list of \emph{some} of them (via zsh tab completion)
    \item Python: no options with values
    \item But some programs may take options with values
  \end{itemize}
 {\tiny
    \begin{semiverbatim}
%Â python3 -<tab>
option
-B   -- don't write .py[co] files on import
-E   -- ignore PYTHON* environment variables (such as PYTHONPATH)
-I   -- isolate Python from the user's environment
-O   -- optimize generated bytecode slightly
-OO  -- remove doc-strings in addition to the -O optimizations
-x   -- skip first line of source, allowing use of non-Unix forms of #!cmd
    \end{semiverbatim}
}

\end{frame}

% page 4 
\begin{frame}{Approach 2: XALT does the filtering for you}
  \begin{itemize}
    \item This consists of two parts in your site Config.py file
    \item Changes to path\_patterns
    \item Add in a new group of patterns: path\_arg\_patterns
  \end{itemize}
\end{frame}

% page 5
\begin{frame}[fragile]
    \frametitle{Adding the CUSTOM tag to path\_patterns}
 {\tiny
    \begin{semiverbatim}
path_patterns = [
    ['CUSTOM',  r'.*\\/python[0-9][^/][^/]*'],
    ...
]
    \end{semiverbatim}
}
  \begin{itemize}
    \item Only paths that have the ``CUSTOM'' tag will get further filtering
    \item A site can have as many ``CUSTOM'' tags as they like
  \end{itemize}

\end{frame}

% page 6
\begin{frame}[fragile]
    \frametitle{The new \texttt{path\_arg\_pattern}}
 {\tiny
    \begin{semiverbatim}
path_arg_patterns = [
  ['SKIP', r'.*\\/python[0-9][^/;][^/;]*;.*\\/share\\/.*'],
  ['PKGS', r'.*\\/python[0-9][^/;][^/;]*;.*\\/data\\/.*'],
  ['PKGS', r'.*\\/python[0-9][^/;][^/;]*;'],
]
    \end{semiverbatim}
}
  \begin{itemize}
    \item The pattern is path + ``;'' + arg as shown above
      \begin{enumerate}
        \item SKIP any python scripts that have /share/ as part of the
          path
        \item KEEP any python scripts that have /data/ as part of the
        \item KEEP any python scripts that have neither of the above
      \end{enumerate}
    \item Note the change in how the executable pattern is written!
  \end{itemize}

\end{frame}

% page 7
\begin{frame}[fragile]
    \frametitle{Rules}
 {\tiny
    \begin{semiverbatim}
    \end{semiverbatim}
}
  \begin{itemize}
    \item For ``CUSTOM'' tags the arguments are each processed
    \item Arguments that start with minus [-] are ignored
    \item All other arguments would be abspath and checked for existance
      before being run through path\_arg\_patterns
    \item Not perfect but reasonably safe
  \end{itemize}
\end{frame}

% page 8
\begin{frame}[fragile]
    \frametitle{Could filter on option arguments}
 {\tiny
    \begin{semiverbatim}
  ['CONTINUE, r'.*\\/python[0-9][^/;][^/;]*;-.*'],
    \end{semiverbatim}
}
  \begin{itemize}
    \item Ignoring options could be under Site control
    \item With the pattern above.
    \item I don't this supporting this would be useful.
  \end{itemize}
\end{frame}

% page 9
\begin{frame}[fragile]
    \frametitle{Final patterns}
 {\tiny
    \begin{semiverbatim}
  ['PKGS', r'.*\\/python[0-9][^/;][^/;]*;'],
    \end{semiverbatim}
}
  \begin{itemize}
    \item This pattern is there to handle when things do not match
    \item If this pattern is not provided then the default final
      pattern is a SKIP
  \end{itemize}
\end{frame}

% page 10
\begin{frame}[fragile]
    \frametitle{False matching}
 {\tiny
    \begin{semiverbatim}
\$ python -z /my/path/share/foo /my/path/data/hello.py

or

\$ python -z /my/path/data/foo /my/path/share/hello.py

    \end{semiverbatim}
}
  \begin{itemize}
    \item Suppose you have either of the above command lines
    \item The first one would be SKIP'ed
    \item The second one would be KEEP'ed
    \item I see no general way to get this to work perfectly
    \item \emph{This is NOT a current issue with python}
  \end{itemize}

\end{frame}

% page 11
\begin{frame}[fragile]
    \frametitle{a SKIP match}
 {\tiny
    \begin{semiverbatim}
\$ XALT\_TRACING=run python /my/path/share/hello\_world.py

    track_executable():
    -> arg: 1: value: "../../share/hello\_world.py"
    -> pattern: "/usr/bin/python3.10;/my/path/share/hello\_world.py",
       track_executable token: 3: SKIP
    \end{semiverbatim}
}
  \begin{itemize}
    \item This is what happens when a pattern matches a SKIP
    \item This can be shown when XALT\_TRACING=run
  \end{itemize}

\end{frame}

% page 12
\begin{frame}[fragile]
    \frametitle{a PKGS match}
 {\tiny
    \begin{semiverbatim}
\$ XALT\_TRACING=run python /my/path/data/hello_world.py

    track\_executable():
    -> arg: 1: value: "../../data/hello\_world.py"
    -> pattern: "/usr/bin/python3.10;/my/path/data/hello\_world.py",
    track_executable token: 1: PKGS

myinit(0/1,LD\_PRELOAD,/usr/bin/python3.10)\{
...
\}
    \end{semiverbatim}
}
  \begin{itemize}
    \item This is what happens when a pattern matches a PKGS
    \item This can be shown when XALT\_TRACING=run
    \item This tag causes the execution to be TRACKED
  \end{itemize}

\end{frame}

% page 13
\begin{frame}[fragile]
    \frametitle{Final pattern}
 {\tiny
    \begin{semiverbatim}
\$ XALT\_TRACING=run python2 /my/path/pkg\_tracking.py --seq 22

   track_executable():
    -> arg: 1: value: "/my/path/pkg\_tracking.py"
    -> pattern: "/usr/bin/python2.7;/my/path/pkg\_tracking.py",
       track_executable token: 5: CONTINUE
    -> arg: 2: value: "--seq"
    -> arg: 3: value: "22"
    -> pattern: "/usr/bin/python2.7;", track_executable token: 1: PKGS

myinit(0/1,LD_PRELOAD,/usr/bin/python2.7)\{
  ...
\}
    \end{semiverbatim}
}
  \begin{itemize}
    \item This last pattern is called after the command line has been
      processed
    \item In this case the tag is PKGS
    \item Without this pattern it is SKIP
  \end{itemize}

\end{frame}

% page 14
\begin{frame}{Conclusions}
  \begin{itemize}
    \item Available now in the testing branch of XALT
    \item It works with the cases I have tested with
    \item Please test it out.
  \end{itemize}
\end{frame}

% page 15
\begin{frame}{Future Topics?}
  \begin{itemize}
    \item No Meeting in April.  I'll be out of town.
    \item Next Meeting will be on May 18, 2023 at 10:00 am
      U.S. Central (15:00 UTC)
  \end{itemize}
\end{frame}

%\input{./themes/license}

\end{document}
