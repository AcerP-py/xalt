\documentclass{beamer}

% You can also use a 16:9 aspect ratio:
%\documentclass[aspectratio=169]{beamer}
\usetheme{TACC16}
\usepackage{graphicx}

% It's possible to move the footer to the right:
%\usetheme[rightfooter]{TACC16}


% Detailed knowledge of application workload characteristics can
% optimize performance of current and future systems. This may sound
% daunting, with many HPC data centers hosting over 2,000 users running
% thousands of applications and millions of jobs per month.  XALT is an
% open source tool developed at the Texas Advanced Computing Center
% (TACC) that collects system usage information to quantitatively report
% how users are using your system. This session will explore the
% benefits of detailed application workload profiling and how the XALT
% tool has helped leading supercomputing sites unlock the power of their
% application usage data.

%% page 
%\begin{frame}{}
%  \begin{itemize}
%    \item
%  \end{itemize}
%\end{frame}
%
%% page 
%\begin{frame}[fragile]
%    \frametitle{}
% {\tiny
%    \begin{semiverbatim}
%    \end{semiverbatim}
%}
%  \begin{itemize}
%    \item
%  \end{itemize}
%
%\end{frame}



\begin{document}
\title[XALT]{Support for filtering based on command line arguments?}
\author{Robert McLay}
\date{February 23, 2023}

% page 1
\frame{\titlepage}

% page 2
\begin{frame}{XALT: Outline}
  \center{\includegraphics[width=.9\textwidth]{XALT_Sticker.png}}
  \begin{itemize}
    \item Let's talk about how XALT might filter based on command line arguments
    \item A site would like to filter on where the python script is located.
    \item I can think of two ways that this might be done
    \item I am open to discussion on how this might be done
    \item I am assuming that command name must pass regular path
      filtering.
    \item Let's see about how a second filter might work.
      
  \end{itemize}
\end{frame}

% page 3
\begin{frame}[fragile]
    \frametitle{Some issue to deal with}
  \begin{itemize}
    \item Many commands take command line argument
    \item This includes python
    \item Below is a list of \emph{some} of them (via zsh tab completion)
    \item Python: no options with values
    \item But may programs take options with values
  \end{itemize}
 {\tiny
    \begin{semiverbatim}
%Â python3 -<tab>
option
-B   -- don't write .py[co] files on import
-E   -- ignore PYTHON* environment variables (such as PYTHONPATH)
-I   -- isolate Python from the user's environment
-O   -- optimize generated bytecode slightly
-OO  -- remove doc-strings in addition to the -O optimizations
-x   -- skip first line of source, allowing use of non-Unix forms of #!cmd
    \end{semiverbatim}
}

\end{frame}

% page 4 
\begin{frame}{Command line parsing is a PITA}
  \begin{itemize}
    \item This is difficult to get right the first time
    \item It much harder to maintain over time
  \end{itemize}
\end{frame}

% page 5
\begin{frame}[fragile]
    \frametitle{Path foo is required}
 {\tiny
    \begin{semiverbatim}
#!/bin/python3

from __future__ import print_function
import os, sys, re

def main():
  for i in sys.argv:
    fn = os.path.abspath(i)
    if (os.path.exists(fn)):
      print (i, fn)
    else:
      print (i)
      
if ( __name__ == '__main__'): main()
    \end{semiverbatim}
}
  \begin{itemize}
    \item running ./try.py or ../../abc/try.py doesn't expand to
      /full/path/try.py
    \item running python3 ../../abc/try.py also doesn't expand to
      /full/path/try.py
    \item Checking argments for abspath and existance will be required
  \end{itemize}

\end{frame}

% page 6
\begin{frame}[fragile]
    \frametitle{Approach 1}
 {\tiny
    \begin{semiverbatim}
       int my_path_parser(const char * cmdName, const char* cmdlineA[])
       \{
         // return 1 for PKG  Use for python if imports tracked
         // return 2 for KEEP
         // return 3 for SKIP
       \}
        
    \end{semiverbatim}
}
  \begin{itemize}
    \item Sites provide a function line the above
    \item XALT will provide a configure option to link in a library or
      a *.o file
  \end{itemize}

\end{frame}

% page 7
\begin{frame}[fragile]
    \frametitle{Approach 2}
 {\tiny
    \begin{semiverbatim}
        path_cmd_patterns = [
        ['SKIP', r'python[0-9.]*;\\
        /share\\/.* ]
           ['PKGS', r'python[0-9.]*;\\/other\\/.* ]
           ...
           ]
    \end{semiverbatim}
}
  \begin{itemize}
    \item The command and the argument would be combined together with
      a semicolon
    \item Command line arguments would be ignored if started with a
      minus [-]
    \item All arguments would be abspath and checked for existance
      before being run through path\_cmd\_patterns
    \item Not perfect but reasonably safe
    \item Comments?
  \end{itemize}

\end{frame}

% page 8
\begin{frame}{Future Topics?}
  \begin{itemize}
    \item I'm looking for Topics.
    \item Next Meeting will be on March 16, 2023 at 10:00 am
      U.S. Central (15:00 UTC)
  \end{itemize}
\end{frame}

%\input{./themes/license}

\end{document}
