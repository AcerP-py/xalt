# -*- python -*-

test_name = "end2end"

test_descript = {
   'description' : "End to end test",
   'keywords'    : [ "simple", test_name,],

   'active'      : True,
   'test_name'   : test_name,

   'run_script'  : """
     . $(projectDir)/rt/common_funcs.sh

     initialize
     buildRmapT
     installXALT

     export PROMPT_COMMAND2="printf '\033k${formed_hostname}\033\\';"


     runMe installDB             # 1

     module --quiet rm $LMOD_FAMILY_MPI $LMOD_FAMILY_COMPILER
     module --quiet load gcc mpich
     PATH=$outputDir/XALT/bin:$outputDir/XALT/sbin:$PATH;

     export XALT_EXECUTABLE_TRACKING=yes

     export XALT_TRANSMISSION_STYLE=direct2db
     echo mpicc -o hello $(projectDir)/rt/mpi_hello_world.c 
     mpicc -o hello $(projectDir)/rt/mpi_hello_world.c 
     check_entries_db.py --dbname $DBNAME --results result.csv --runs 3 --functions 4

     #export PATSQ="I am end2end's variable with utf8 chars: ñèéï¿¡¤â¢ª¯±ç·å£§µ×þÐ¬øØ€αβγ"
     #
     #mpirun -n 1 ./hello 
     #
     #mpicc -o helloñ $(projectDir)/rt/mpi_hello_world.c
     #
     #rm -rf Ðì®
     #mkdir Ðì®
     #mv helloñ Ðì®
     # 
     #mpirun -n 1 Ðì®/helloñ
     #
     #export LD_PRELOAD=$outputDir/XALT/libexec/libxalt_init.so
     #./hello
     #
     #export XALT_USERS="$USER;$outputDir"
     #xalt_file_to_db.py  --dbname $DBNAME --reverseMapD $outputDir/reverseMapD
     #
     #check_entries_db.py --dbname $DBNAME --results result.csv --runs 3 --functions 4
     removeDataBase.py   --dbname $DBNAME  
     finishTest -o $(resultFn) -t $(runtimeFn) result.csv
   """,

   'tests' : [
      { 'id' : 't1', 'tol' : 1.01e-6},
   ],
}
